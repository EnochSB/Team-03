{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container text-nowrap">
  <div class="row">
    
      <!-- 왼쪽 사이드바 < 지도 > -->
      <div class="col-3">
        <div class='card'>
          {% comment %} <div>지도</div> {% endcomment %}
          <a href="{% url 'dinings:dining_create'%}">create</a>
          <a href="{% url 'dinings:review_create' dining.pk %}">리뷰작성</a>
          <a href="{% url 'dinings:dining_update' dining.pk  %}">수정</a>
         
          <p>맛집더보기</p>
        </div>
      </div>


      <!-- 오른쪽 상세 페이지 -->
      <div class="col-9">

        <!-- 1번 상자 -->
        <div class="card container mb-3">
          <div class="row mt-2">
            <div class="col-6 pe-0">
              <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
              <div class="row row-cols-2">
                <div class="col pe-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
                <div class="col ps-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
              </div>
            </div>
            <div class="container col-6 ps-0">
              <div class="row row-cols-2">
                <div class="col pe-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
                <div class="col ps-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
                <div class="col pe-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
                <div class="col ps-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
                <div class="col pe-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
                <div class="col ps-0">
                  <img src="https://cdn.pixabay.com/photo/2019/08/01/12/36/illustration-4377408_960_720.png" alt="..." class="img-fluid">
                </div>
              </div>
            </div>
          </div>
          <div class="container mt-3">
            <h1>{{ dining.title }}</h1>
            <div class="d-flex gap-2">
              <p>{{ dining.address_city }} |  </p>
              <!-- 검색 view 생성하기 -->
              <p>음식종류</p>
            </div>
            <div class="d-flex gap-2">
              <b><p>{{ reviews.half_star_rating }}점</p></b>
              <p class="sm_text">{{ reviews.all|length }}명의 평가</p>
              <b><p class="m_text">{{ avg }}점</p></b>
              <!-- 임시로 넣어두었음 , 총 별점 나타내야 함-->
              {% for review in reviews %}
              <p>{{ review.star_rating }} </p>
              {% endfor %}
            </div>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-3">
            <div class="d-flex gap-2">
              <form action="{% url 'dinings:likes' dining.pk %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="m_text rounded-pill btn btn-outline-dark"><i class="bi 
                  {% if request.user in dining.like_users.all %}
                    bi-heart-fill
                  {% else %}
                    bi-heart
                  {% endif %}
                  "></i>
              </form>
              좋아요<span>({{ dining.like_users.all|length }})</span></button>
              <button type="button" class="rounded-pill btn btn-outline-dark m_text "><span class="material-symbols-rounded mx-1">
                open_in_new
                </span>공유</button>
            </div>
            <button type="button" class="m_text rounded-pill btn btn-outline-dark "><span class="material-symbols-rounded mx-1">
              edit
              </span>평가하기</button>

          </div>
        </div>

        <!-- 2번 상자 -->
        <div class="container card mb-3 py-2 ">
          <div class="d-flex gap-2">
            <span class="icon_size material-symbols-rounded">
              location_on
              </span>
            <a href="#">{{ dining.address_mc_do}}</a>
            <a href="#">{{ dining.address_city}}</a>
            <a href="#">{{ dining.address_dong}}</a>
            <p>{{ dining.address_detail }}</p>
          </div>
          <div class="d-flex gap-2">
            <span class="icon_size material-symbols-rounded">
              book
              </span>
            <p>{{ dining.phone_number }}</p>
          </div>
          <div class="d-flex gap-2">
            <span class="icon_size material-symbols-rounded">
              sell
              </span>
            {% for tag in dining.tags.all %}
              <p href="#">{{ tag.name }}</p>
            {% endfor %}
          </div>
          <!-- 추가 하고싶으면 하면 될듯함-->
          <div class="d-flex gap-2">
            <span class="icon_size material-symbols-rounded">
              add_circle
              </span>
            {% for tag in dining.tags.all %}
              <p href="#">{{ tag.name }}</p>
            {% endfor %}
          </div>
          <!-- 모달 넣기 -->
          <div class="d-flex gap-2">
            <span class="icon_size material-symbols-rounded">
              chat
              </span>
            <a href="">폐업신고</a>
            <a href="">정보수정 제안</a>
          </div>
        </div>

        <!-- 3번 상자 -->
        <div class="container card mb-3">
          <h2>영업시간</h2>
          <div class="d-flex justify-content-between">
            <!-- 요일 추가 -->
            <p>요일</p>
            <!-- 시간 -->
            <p>{{ dining.opening_hours }}</p>
          </div>
          <hr>
          <h2>메뉴정보</h2>
          <div class="d-flex justify-content-between p-2">
            {% for menu in menus %}
            <div class='d-flex justify-content-between'>
                <p>{{menu.name}}</p>
                <p>{{menu.price}}</p>
              </div>
            {% endfor %}
            <button class="btn btn-primary menu-add">추가</button>
            <div class="menu-form" style="display:none;">
              <form action="{% url 'dinings:menu_create' dining.pk %}" method="POST">
                {% csrf_token %}
                {{ menu_form.as_p }}
                <input type="submit" value="입력">
              </form>
            </div>
          </div>
          <hr>
          <h2>맛집태그</h2>
          
          <div class="d-flex gap-3">
            <!-- 태그 수 많을 수록 텍스트 크기 커지게 -->
            {% for tag in dining.tags.all %}
            <p>{{ tag.name }}</p>
            {% endfor %}
          </div>
          <hr>
          <h2>맛집태그</h2>
          
          <div class="d-flex gap-3">
            <!-- 태그 수 많을 수록 텍스트 크기 커지게 -->
            {% for tag in dining.tags.all %}
            <p>{{ tag.name }}</p>
            {% endfor %}
          </div>
        </div>

        <!-- 리뷰 -->
        <div class="container card mb-3">
          <h3 class="my-auto mt-3">{{ reviews.all|length }}건의 방문자 평가</h3>
          <hr>
          <div class="d-flex">
            <div class="col-8">
              <p>{{ avg }}점</p>
              <div class="d-flex gap-1">
              
                <!-- 리뷰에 평가 세부모델 추가하기 -->
                <p>맛</p>
                <p>가격</p>
                <p>서비스</p>
              </div>
              <div class="sm_tag row ">
                <div class="d-flex gap-5">
                  <p>방문목적</p>
                  <div class="d-flex gap-3">
                    {% for tag in dining.tags.all %}
                    <p class="border rounded-pill px-2"style="background-color: rgb(227, 227, 227);">{{ tag.name }}</p>
                    {% endfor %}
                  </div>
                </div>
                <div class="d-flex gap-5">
                  <p>분위기</p>
                  <div class="d-flex gap-3">
                    {% for tag in dining.tags.all %}
                    <p class="border rounded-pill px-2"style="background-color: rgb(227, 227, 227);">{{ tag.name }}</p>
                    {% endfor %}
                  </div>
                </div>
                <div class="d-flex gap-5">
                  <p>편의시설</p>
                  <div class="d-flex gap-3">
                    {% for tag in dining.tags.all %}
                    <p class="border rounded-pill px-2"style="background-color: rgb(227, 227, 227);">{{ tag.name }}</p>
                    {% endfor %}
                  </div>
                </div>
              </div>


            </div>
            <div class="col-4">
              <div class="d-flex">
                <p>매우만족(5)</p>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100">20</div>
                </div>
              </div>
              <div class="d-flex">
                <p>만족(4)</p>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">20</div>
                </div>
              </div>
              <div class="d-flex">
                <p>보통(0)</p>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">20</div>
                </div>
              </div>
              <div class="d-flex">
                <p>불만(5)</p>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">20</div>
                </div>
              </div>
              <div class="d-flex">
                <p>매우 불만(5)</p>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">20</div>
                </div>
              </div>
            </div>
          </div>
          <hr>

          

          {% for review in reviews %}
            <div class="container card ">
              <div class="d-flex ">
                <!-- 프로필 사진 추가-->
                {% if review.user.profile_image %}
                  <img class="p-1 rounded-circle" src="{{ review.user.profile_image.url }}" alt="profile_image">
                {% else %}
                  <img class="p-1 rounded-circle" src="{% static 'img/blank-profile-image.png' %}" class="img-fluid" style="width: 70px; height: 70px;" alt="blank-profile-image">
                {% endif %}
                <div class="container mt-2">
                  <div class="d-flex gap-2">
                    <p>{{ review.user.username }}</p>
                    <p>작성개수{{ review.user.review_set.all|length }},공감개수{{ review.like_users.all|length }}</p>
                  </div>
                  <div class="d-flex gap-2">
                    <p>{{ review.star_rating }} </p>
                    <p>날짜</p>
                  </div>
                </div>
              </div>
              <div class="d-flex gap-1">
                <p>맛 {{ review.star_rating_taste }}</p>
                <p>가격 {{ review.star_rating_price }}</p>
                <p>서비스 {{ review.star_rating_kind }}</p>
              </div>
              <!-- 댓글은 wrap 사용-->
              <div class="text-wrap">
                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Inventore, non similique repellat dolor facilis rerum omnis. Cum tempora numquam molestiae laborum ut in sint, totam dolorem reiciendis asperiores nemo veritatis earum ipsam omnis porro delectus a! Sint adipisci nostrum tempora veniam fuga, iusto non quas nulla consequuntur harum, pariatur labore?
              </div>
              <img src="" alt="#">
              <div class="d-flex gap-2 sm_tag">
                {% for tag in dining.tags.all %}
                <p class="border rounded-pill px-2"style="background-color: rgb(227, 227, 227);">{{ tag.name }}</p>
                {% endfor %}
              </div>
              <button class="d-block">공감</button>
            </div>
          {% empty %}
            <p>아직 리뷰가 없습니다.</p>
          {% endfor %}

        </div>
      </div>

  </div>
</div>
{% endblock content %}

{% block script %}
<script>
  const menuAddBtn = document.querySelector('.menu-add')
  const menuForm = document.querySelector('.menu-form')
  menuAddBtn.addEventListener('click', (event) => {
    menuForm.setAttribute('style', '')
    menuAddBtn.setAttribute('style', 'display:none')
  })
</script>
{% endblock script %}